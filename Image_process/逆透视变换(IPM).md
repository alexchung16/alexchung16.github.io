# 逆透视变换（IPM）



## 基本概念

### 单应性矩阵

* 定义

  单应性矩阵（Homography Matrix）通常用于描述在不同视角下的两个图像平面之间的映射关系。前缀“homo”是“same”的意思，表示“同”，“Homography”即同一个源产生的"graphy",即单应性矩阵。

  单应性矩阵是一个$3 \times 3$ 的矩阵$H$，它将一个图像中的点映射到另一个图像中的点。给定图像平面上一个点$p = [x, y, 1]^T$ 和其在另一个图像中的对应点 $p' = [x', y', 1]^T$，这种映射关系可以表示为：

  $$ p′=H⋅p$$

  其中 $H$是单应性矩阵。

* 形式

  单应性矩阵$H$的表示如下

  $$H = \begin{bmatrix} h_{11} & h_{12} & h_{13} \\ h_{21} & h_{22} & h_{23} \\ h_{31} & h_{32} & h_{33} \end{bmatrix}$$

* 计算

  假设给$H$的元素同乘同一个数$a$,得到的单应性矩阵$aH$与$H$的作用相同，新的单应性矩阵只是把齐次点$x_1$变成了齐次点$ax_1$。因此我们可以把$a$替换成$\frac{1}{h_{33}}$，此时单应性矩阵$H$变为

  $$H = \begin{bmatrix} \frac{h_{11}}{h_{33}} & \frac{h_{12}}{h_{33}} & \frac{h_{13}}{h_{33}} \\ \frac{h_{21}}{h_{33}} & \frac{h_{22}}{h_{33}} & \frac{h_{23}}{h_{33}} \\ \frac{h_{31}}{h_{33}} & \frac{h_{32}}{h_{33}} & 1 \end{bmatrix}$$

  因此**单应性矩阵的自由度为8**，相应的至少需要四对非共线的点对来计算单应性矩阵。利用这些点，可以通过最小二乘法或直接线性变换（DLT）算法来求解

### 仿射变换

* 定义

  仿射变换是保持直线性和平行性的几何变换。即经过仿射变换，直线仍然是直线，且平行线仍然平行。仿射变换可以包括平移、缩放、旋转、剪切等操作。

* 形式

  仿射变换通常可以用一个 $2 \times 3$的矩阵来表示。对于一个二维点 $p = [x, y]^T$，其变换后的点 $p' = [x', y']^T 通过以下矩阵运算得到：

  $\begin{bmatrix} x' \\ y' \end{bmatrix} = \begin{bmatrix} a_{11} & a_{12} & t_x \\ a_{21} & a_{22} & t_y \end{bmatrix} \begin{bmatrix} x \\ y \\ 1 \end{bmatrix}$

  其中，矩阵的前两列$\begin{bmatrix} a_{11} & a_{12} \end{bmatrix}$和 $\begin{bmatrix} a_{11} & a_{12} \end{bmatrix}$决定了线性变换（如旋转、缩放、剪切），最后一列 $\begin{bmatrix} t_x & t_y \end{bmatrix}$决定了平移。

* 性质
  * 保持直线性和平行性。
  * 比例关系（中点、三分点等）保持不变。

### 投射变换

* 定义

  投射变换又叫射影变换，是一种更一般的几何变换，不仅可以包括仿射变换，还可以包括透视效应。投射变换不会保持平行性，似的放射变换产生非线性效应，这样的特性非常适合模拟透视效果。

* 形式

  投射变换用一个$3 \times 3$的矩阵 $H$ 表示，对于一个二维点 $p = [x, y, 1]^T$，其变换后的点 $p' = [x', y', w']^T$通过以下矩阵运算得到：

  $$p' = H \cdot p = \begin{bmatrix} h_{11} & h_{12} & h_{13} \\ h_{21} & h_{22} & h_{23} \\ h_{31} & h_{32} & h_{33} \end{bmatrix} \begin{bmatrix} x \\ y \\ 1 \end{bmatrix}$$

* 性质

  * 保持重合关系和交比不变。
  * 可以将直线映射为直线，但不保持平行性。
  * 可以表示透视效果，如将平行线映射为汇聚于一点。

## IPM投影



## 参考资料

* https://leijiezhang001.github.io/lane-det-from-BEV/

